<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>CryptoName</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <meta content="" name="keywords">
    <meta content="" name="description">

    <!-- Favicons -->
    <link href="img/favicon.png" rel="icon">
    <link href="img/apple-touch-icon.png" rel="apple-touch-icon">

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,500,600,700,700i|Montserrat:300,400,500,600,700" rel="stylesheet">

    <!-- Bootstrap CSS File -->
    <link href="lib/bootstrap/css/bootstrap.min.css" rel="stylesheet">

    <!-- Libraries CSS Files -->
    <link href="lib/font-awesome/css/font-awesome.min.css" rel="stylesheet">
    <link href="lib/animate/animate.min.css" rel="stylesheet">
    <link href="lib/ionicons/css/ionicons.min.css" rel="stylesheet">
    <link href="lib/owlcarousel/assets/owl.carousel.min.css" rel="stylesheet">
    <link href="lib/lightbox/css/lightbox.min.css" rel="stylesheet">

    <!-- Main Stylesheet File -->
    <link href="css/style.css" rel="stylesheet">
    <script type="text/javascript" src="./js/web3.min.js"></script>
    <script src="./js/lodash.min.js"></script>
    <script type="text/javascript" src="./js/jquery-3.2.1.min.js"></script>
    <script src="./js/vue.min.js"></script>
    <script src="./js/vue-clipboard.min.js"></script>
    <script type="text/javascript">
        document.write('<script src="./js/contractConfig.js?v=' + (new Date()).getTime() + '"><\/script>');
    </script>
    <style>
        [v-cloak] {
            display: none;
        }
        
        body {
            background-color: #FEFEFE;
        }
        
        .btn1 {
            text-align: center;
            margin: 0 auto;
            margin-bottom: 5px;
            cursor: pointer;
            width: 200px;
            line-height: 50px;
            height: 50px;
            border-radius: 4px;
            background-color: #F5841F;
            color: #ffffff;
        }
        
        .spinner {
            display: block;
            margin: 100px auto 0;
            width: 150px;
            text-align: center;
        }
        
        .spinner>div {
            width: 30px;
            height: 30px;
            background-color: #67CF22;
            border-radius: 100%;
            display: inline-block;
            -webkit-animation: bouncedelay 1.4s infinite ease-in-out;
            animation: bouncedelay 1.4s infinite ease-in-out;
            /* Prevent first frame from flickering when animation starts */
            -webkit-animation-fill-mode: both;
            animation-fill-mode: both;
        }
        
        .spinner .bounce1 {
            -webkit-animation-delay: -0.32s;
            animation-delay: -0.32s;
        }
        
        .spinner .bounce2 {
            -webkit-animation-delay: -0.16s;
            animation-delay: -0.16s;
        }
        
        @-webkit-keyframes bouncedelay {
            0%,
            80%,
            100% {
                -webkit-transform: scale(0.0)
            }
            40% {
                -webkit-transform: scale(1.0)
            }
        }
        
        @keyframes bouncedelay {
            0%,
            80%,
            100% {
                transform: scale(0.0);
                -webkit-transform: scale(0.0);
            }
            40% {
                transform: scale(1.0);
                -webkit-transform: scale(1.0);
            }
        }
        
        .shuoming {
            height: 38px;
            background: #F1F6FA;
            line-height: 38px;
            text-align: left;
        }
        
        .save {
            display: inline-block;
            background: #347AF0;
            border-radius: 20px;
            width: 150px;
            height: 30px;
            line-height: 30px;
            color: #ffffff;
            cursor: pointer;
        }
        
        .leftbtn {
            display: inline-block;
            background: #F1F6FA;
            border-radius: 20px;
            width: 150px;
            height: 30px;
            line-height: 30px;
            text-align: center;
            color: #E6E8EB;
            cursor: pointer;
        }
        
        .rightbtn {
            display: inline-block;
            background: #347AF0;
            text-align: center;
            border-radius: 20px;
            width: 150px;
            height: 30px;
            line-height: 30px;
            color: #ffffff;
            cursor: pointer;
        }

        .value_box {
            border-bottom: 1px solid #dbdbdb;  
            border-top:0px;  
            border-left:0px;  
            border-right:0px;
            width: 90%;
        }
    </style>

</head>

<body>
    <header id="header">

        <div id="topbar">
            <div class="container">
                <div class="social-links">
                    <a href="https://t.me/CryptoName1" class="Telegram"><i class="fa fa-telegram"></i></a>
                    <a href="https://twitter.com/CryptoNameOrg" class="twitter"><i class="fa fa-twitter"></i></a>
                    <a href="https://www.instagram.com/cryptoname_/?hl=en" class="instagram"><i class="fa fa-instagram"></i></a>
                </div>
            </div>
        </div>

        <div class="container">

            <div class="logo float-left">
                <!-- Uncomment below if you prefer to use an image logo -->
                <h1 class="text-light"><a href="#intro" class="scrollto"><span>CryptoName</span></a></h1>
                <!-- <a href="#header" class="scrollto"><img src="img/logo.png" alt="" class="img-fluid"></a> -->
            </div>

            <nav class="main-nav float-right d-none d-lg-block">
                <ul>
                    <li><a href="./index.html">Home</a></li>
                    <li><a href="./register.html">Register</a></li>
                    <li><a href="https://onsale.elastosmall.com">Sale</a></li>
                    <!--li><a href="./auction.html">Auction</a></li-->
                    <li><a href="./guide.html">Guide</a></li>
                    <li><a href="./developer.html">Developer</a></li>
                    <li><a href="./account.html">Account</a></li>
                </ul>
            </nav>
            <!-- .main-nav -->

        </div>
    </header>
    <!-- #header -->
    <div style="height:150px"></div>
    <div class="container" id="app">

        <div class="spinner" v-if="loading">

            <div class="bounce1"></div>

            <div class="bounce2"></div>

            <div class="bounce3"></div>
        </div>
        <div class="row text-center" style="color: #0000ff;font-size: 18px;" v-if="loading">
            <div class="col-sm-12">Transaction confirmation in progress</div>
        </div>

        <div v-if="!loading">
            <div class="row text-center" style="margin: 50px">
                <div class="col-sm-12 text-center" >
                    <span style="color: #000000;font-size: 28px;">{{domainName}}</span>.elastos.name
                </div>
            </div>
            <div class="row text-center" style="margin-top: 10px;">
                <div class="col-sm-2">

                </div>
                <div class="col-sm-8 shuoming">
                    Default keys
                </div>
                <div class="col-sm-2">

                </div>
            </div>

            <div class="row text-center" style="margin-top: 10px;" v-for="(value,key) in defaultKeys">
                <div class="col-sm-2">

                </div>
                <div class="col-sm-2 text-left">
                    {{key}}:
                </div>
                <div class="col-sm-6 text-left" style="padding-left:0px">
                    <input v-model="defaultKeys[key]" class="value_box" />
                    <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-check-circle" fill="green" xmlns="http://www.w3.org/2000/svg"  v-if="checkedKeys[ key ]">
                      <path fill-rule="evenodd" d="M8 15A7 7 0 1 0 8 1a7 7 0 0 0 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                      <path fill-rule="evenodd" d="M10.97 4.97a.75.75 0 0 1 1.071 1.05l-3.992 4.99a.75.75 0 0 1-1.08.02L4.324 8.384a.75.75 0 1 1 1.06-1.06l2.094 2.093 3.473-4.425a.236.236 0 0 1 .02-.022z"/>
                    </svg>
                </div>
                <div class="col-sm-2 text-left">

                </div>
            </div>


            <div class="row text-center" style="margin-top: 20px;">
                <div class="col-sm-12" @click="goLogo()">
                    <img src="./img/elaphant.png" /> <span style="vertical-align: middle;color: #5157DB;border-bottom:1px solid #5157DB;cursor: pointer;">Start Elaphant to fill in quickly</span>
                </div>
            </div>

            <div class="row text-center" style="margin-top: 10px;">
                <div class="col-sm-2">

                </div>
                <div class="col-sm-8">
                    <span class="save" @click="submit">Save</span>
                </div>
                <div class="col-sm-2">

                </div>
            </div>


            <div class="row text-center" style="margin-top: 50px;cursor: pointer;" @click="newKey">
                <div class="col-sm-2">

                </div>
                <div class="col-sm-8 shuoming">
                    Extended keys <span style="float: right;">+</span>
                </div>
                <div class="col-sm-2">

                </div>
            </div>
            <div v-for="item in keyValueArr">
                <div class="row text-center" style="margin-top: 10px;">
                    <div class="col-sm-2">

                    </div>
                    <div class="col-sm-2 text-left">
                        {{item["key"]}}:
                    </div>
                    <div class="col-sm-6 text-left" style="padding-left:0px;word-break:break-all;">
                        <div class="value_box">{{item['value']}}</div>
                        <svg style="cursor: pointer;position:absolute;right:40px;top:8px" width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-check-circle" fill="green" xmlns="http://www.w3.org/2000/svg" v-if="checkedKeys[ item['key'] ]">
                          <path fill-rule="evenodd" d="M8 15A7 7 0 1 0 8 1a7 7 0 0 0 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                          <path fill-rule="evenodd" d="M10.97 4.97a.75.75 0 0 1 1.071 1.05l-3.992 4.99a.75.75 0 0 1-1.08.02L4.324 8.384a.75.75 0 1 1 1.06-1.06l2.094 2.093 3.473-4.425a.236.236 0 0 1 .02-.022z"/>
                        </svg>{{ checkedKeys[ item['key'] ] }}
                        <img style="cursor: pointer;position:absolute;right:10px;top:5px" src="./img/edit.png" @click="eidtKey(item)" v-if="!isEidt[item['key']]" />
                        <img style="cursor: pointer;position:absolute;right:10px;top:5px;width:16px;height:16px" src="./img/delete2.png" @click="deleteKey(item)" v-if="isEidt[item['key']]" />
                    </div>
                    <div class="col-sm-2 text-left">

                    </div>
                </div>

                <div class="row" v-if="isEidt[item['key']]" style="margin-top: 15px;">
                    <div class="col-sm-2 text-left">

                    </div>
                    <div class="col-sm-8 text-left">
                        <input v-model="item['value']" style="width: 100%;" />
                    </div>
                    <div class="col-sm-2 text-left">

                    </div>
                </div>

                <div class="row text-left" style="margin-top: 10px;" v-if="isEidt[item['key']] && (item['key']=='messenger' || item['key']=='messagewall')">
                    <div class="col-sm-2">

                    </div>
                    <div class="col-sm-2">
                        Please sign this string via Elephant:
                    </div>
                    <div class="col-sm-8 text-right">
                        <p class="text-left">{{ domainName.toLowerCase()+".elastos.name"+item['key']+selectAddress }}</p>
                    </div>
                </div>
                <div class="row text-center" style="margin-top: 10px;" v-if="isEidt[item['key']]">
                    <div class="col-sm-5">

                    </div>
                    <div class="col-sm-5 text-right">
                        <span class="leftbtn" @click="editCancle(item)">Cancel</span> <span class="rightbtn" @click="editSave(item)">Save</span>
                    </div>
                    <div class="col-sm-2 text-left">

                    </div>
                </div>
            </div>
            <div class="row text-center" style="margin-top: 10px;" v-if="isNew">
                <div class="col-sm-2">

                </div>
                <div class="col-sm-2 text-right">
                    <input placeholder="Please input key" style="width:100%;" v-model="keyValueObj.key" />

                </div>
                <div class="col-sm-6 text-left" style="padding-left:0px">
                    <input placeholder="Please input value" v-model="keyValueObj.value" style="width:90%;" />
                </div>
                <div class="col-sm-2 text-left">
                    
                </div>
            </div>
            <div class="row text-left" style="margin-top: 10px;" v-if="isNew && (keyValueObj.key=='messenger' || keyValueObj.key=='messagewall')">
                <div class="col-sm-2">

                </div>
                <div class="col-sm-2">
                    Please sign this string via Elephant:
                </div>
                <div class="col-sm-8 text-right">
                    <p class="text-left">{{ domainName.toLowerCase()+".elastos.name"+keyValueObj.key+selectAddress }}</p>
                </div>
            </div>

            <div class="row text-center" style="margin-top: 10px;" v-if="isNew">
                <div class="col-sm-5">

                </div>
                <div class="col-sm-5 text-right">
                    <span class="leftbtn" @click="newCancle">Cancel</span> <span class="rightbtn" @click="newSave">Save</span>
                </div>
                <div class="col-sm-2 text-left">

                </div>
            </div>
        </div>
    </div>
    <div style="height: 150px;"></div>
    <footer id="footer" class="section-bg">
        <div class="container">
            <div class="copyright">
                <b>contact us:</b>
                <a href="https://t.me/CryptoName1" class="Telegram"><i class="fa fa-telegram"></i></a>
                <a href="https://twitter.com/CryptoNameOrg" class="twitter"><i class="fa fa-twitter"></i></a>
                <a href="https://www.instagram.com/cryptoname_/?hl=en" class="instagram"><i class="fa fa-instagram"></i></a>
            </div>
            <div class="copyright">
                <div style="color:#7B7B7B">
                    <a href="https://cryptoname.org"><img src="img/logo.png" style="height:32px"></a>
                </div>
            </div>
        </div>
    </footer>

    <a href="#" class="back-to-top"><i class="fa fa-chevron-up"></i></a>

    <!-- Uncomment below i you want to use a preloader -->
    <!-- <div id="preloader"></div> -->

    <!-- JavaScript Libraries -->
    <script src="lib/jquery/jquery.min.js"></script>
    <script src="lib/jquery/jquery-migrate.min.js"></script>
    <script src="lib/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="lib/easing/easing.min.js"></script>
    <script src="lib/mobile-nav/mobile-nav.js"></script>
    <script src="lib/wow/wow.min.js"></script>
    <script src="lib/waypoints/waypoints.min.js"></script>
    <script src="lib/counterup/counterup.min.js"></script>
    <script src="lib/owlcarousel/owl.carousel.min.js"></script>
    <script src="lib/isotope/isotope.pkgd.min.js"></script>
    <script src="lib/lightbox/js/lightbox.min.js"></script>
    <!-- Contact Form JavaScript File -->
    <script src="contactform/contactform.js"></script>

    <!-- Template Main Javascript File -->
    <script src="js/elastos-wallet-api.js"></script>
    <script src="js/main.js"></script>
</body>
<script>
    var app = new Vue({
        el: '#app',
        data: {
            loading: false,
            selectAddress: "",
            domainName: "",
            defaultKeys: {
                "did": "",
                "publickey": "",
                "btc.address": "",
                "ela.address": "",
                "eth.address": "",
            },
            checkedKeys: {},
            schemeConfig: {
                "AppID": "ac89a6a3ff8165411c8426529dccde5cd44d5041407bf249b57ae99a6bfeadd60f74409bd5a3d81979805806606dd2d55f6979ca467982583ac734cf6f55a290",
                "AppName": "Mini Apps",
                "RandomNumber": "123456789",
                "DID": "ibxNTG1hBPK1rZuoc8fMy4eFQ96UYDAQ4J",
                "PublicKey": "034c51ddc0844ff11397cc773a5b7d94d5eed05e7006fb229cf965b47f19d27c55",
                "ReturnUrl": "/editInfo.html?name=test1",
                "RequestInfo": "ELAAddress,BTCAddress,ETHAddress"
            },
            keyValueArr: [],
            keyValueObj: {
                "key": "",
                "value": ""
            },
            curKeyValueObj: {

            },
            isNew: false,
            isEidt: {},
        },
        methods: {
            editSave(item) {
                this.$set(this.isEidt, item.key, false);
                this.edit(item);
            },
            editCancle(item) {
                this.$set(this.isEidt, item.key, false);
            },
            deleteKey(item) {
                this.$set(this.isEidt, item.key, false);
                this.curKeyValueObj = _.cloneDeep(item);
                this._generate_option("").then((option) => {
                    this.removeKeyword(this.curKeyValueObj, option);
                }).catch((err) => {

                });
            },
            eidtKey(item) {
                this.$set(this.isEidt, item.key, true);
            },
            newKey() {
                this.isNew = true;
            },
            newSave() {
                this.isNew = false;
                this.add();
            },
            newCancle() {
                this.keyValueObj.key = "";
                this.keyValueObj.value = "";
                this.isNew = false;
            },
            doCopy(text) {
                this.$copyText(text).then((e) => {
                    alert("copy Sucess");
                }, (e) => {})
            },
            edit(item) {
                if (item.value === "") {
                    alert("please input value");
                    return false
                }

                this.curKeyValueObj = _.cloneDeep(item);
                this._generate_option("").then((option) => {
                    this.setKeyword(this.curKeyValueObj, option);
                }).catch((err) => {

                });
            },
            add() {
                if (this.keyValueObj.key === "") {
                    alert("please input key");
                    return false
                }

                if (this.keyValueObj.value === "") {
                    alert("please input value");
                    return false
                }

                this.curKeyValueObj = _.cloneDeep(this.keyValueObj);
                this._generate_option("").then((option) => {
                    this.setKeyword(this.curKeyValueObj, option);
                }).catch((err) => {

                });
            },
            getUrl() {
                //获取主机地址
                var localhostPaht = window.location.protocol + "//" + window.location.host;
                return localhostPaht;
            },
            goLogo() {
                //构建身份授权协议
                var url = this.buildIdentity();
                //拼接大象钱包过度页面
                var turl = 'https://launch.elaphant.app?appName=CryptoName&appTitle=CryptoName&autoRedirect=True&redirectURL=' + encodeURIComponent(url);
                //跳转
                location.href = turl;
            },
            buildIdentity() {
                var baseUrl = this.getUrl();
                this.schemeConfig['ReturnUrl'] = baseUrl + '/editInfo.html?name=' + this.domainName;
                var url = "elaphant://identity?";
                _.forEach(this.schemeConfig, function(val, key, index) {
                    if (key === 'ReturnUrl') {
                        val = encodeURIComponent(val);
                    }
                    url += key + '=' + val + '&';
                });

                return url.substring(0, url.length - 1);
            },
            checkParams() {
                // for (let key in this.defaultKeys) {
                //     if (this.defaultKeys[key] === "") {
                //         alert("input " + key);
                //         return false;
                //     }
                // }
                return true;
            },
            submit() {
                if (this.checkParams()) {
                    this._generate_option("").then((option) => {
                        this.getContracts(option);
                    }).catch((err) => {

                    });
                }
            },
            GetQueryString(name) {　　　
                var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i");
                var r = window.location.search.substr(1).match(reg);　　　
                if (r != null) return (r[2]);　　　
                return null;
            },
            getAjax(url) {
                return new Promise((resovle, reject) => {
                    $.ajax({
                        url: url,
                        dataType: 'json',
                        contentType: 'application/json',
                        type: 'GET',
                        success: function(data) { //成功回调函数
                            resovle(data);
                        },
                        error: function(err) { //失败回调函数
                            reject(err);
                        }
                    });
                });
            },
            next(txid, type) {
                let sid = setInterval(() => {
                    if (typeof web3 !== 'undefined') {
                        web3 = new Web3(web3.currentProvider);
                    }
                    web3.eth.getTransaction(txid, (err, data) => {
                        let blockHash = data['blockHash'] || "";
                        let blockNumber = data['blockNumber'] || "";
                        if (blockHash != "" && blockNumber != '') {
                            this.loading = false;
                            clearInterval(sid);
                            if (type === "removeKeyword") {
                                this.getAjax(window.API_URL+'/nameInfo/set?name=' + this.domainName).then((result) => {
                                    let code = result["code"];
                                    if (code === 200) {
                                        console.log(result["message"]);
                                        this.keyValueArr = [];
                                        this.init();
                                    } else {
                                        alert(JSON.stringify(result));
                                    }
                                }).catch((err) => {
                                    alert("err:" + JSON.stringify(err));
                                });
                            } else if (type === "setKeyword") {
                                this.getAjax(window.API_URL+'/nameInfo/set?name=' + this.domainName).then((result) => {
                                    let code = result["code"];
                                    if (code === 200) {
                                        console.log(result["message"]);
                                        this.keyValueArr = [];
                                        this.init();
                                    } else {
                                        alert(JSON.stringify(result));
                                    }
                                }).catch((err) => {
                                    alert("err:" + JSON.stringify(err));
                                });
                            } else if (type === "setBasicInfo") {
                                this.getAjax(window.API_URL+'/nameInfo/set?name=' + this.domainName).then((result) => {
                                    let code = result["code"];
                                    if (code === 200) {
                                        console.log(result["message"]);
                                        window.location.href = "./view.html?name=" + this.domainName;
                                    } else {
                                        alert(JSON.stringify(result));
                                    }
                                }).catch((err) => {
                                    alert("err:" + JSON.stringify(err));
                                });
                            }
                        }
                    });
                }, 500);
            },
            async getContracts(option) {
                if (window.ethereum) {
                    window.web3 = new Web3(ethereum);
                    try {
                        await ethereum.enable();
                        var infoContract = new web3.eth.Contract(window.elaAbi, window.contractAddres);
                        infoContract.methods.setBasicInfo(this.domainName.trim().toLowerCase(), this.defaultKeys["btc.address"].trim(), this.defaultKeys["eth.address"].trim(), this.defaultKeys["ela.address"].trim(), this.defaultKeys.did.trim(), this.defaultKeys.publickey.trim()).send(option, (err, msg) => {
                            if (!err) {
                                this.loading = true;
                                this.next(msg, "setBasicInfo");
                            }
                        });
                    } catch (error) {
                        // User denied account access...
                        console.log(error);
                    }
                } else if (window.web3) {
                    window.web3 = new Web3(web3.currentProvider);
                }
                // Non-dapp browsers...
                else {
                    console.log('Non-Ethereum browser detected. You should consider trying MetaMask!');
                }
            },
            async _generate_option(price) {
                return web3.eth.getGasPrice()
                    .then((gasPrice) => {
                        if (price)
                            return {
                                from: this.selectAddress,
                                gasPrice: gasPrice,
                                gas: 1000000,
                                value: web3.utils.toWei(price, "ether")
                            };
                        else
                            return {
                                from: this.selectAddress,
                                gasPrice: gasPrice,
                                gas: 1000000,
                                value: '0'
                            };
                    });
            },

            async setKeyword(item, option) {
                if (window.ethereum) {
                    window.web3 = new Web3(ethereum);
                    try {
                        await ethereum.enable();
                        var infoContract = new web3.eth.Contract(window.elaAbi, window.contractAddres);
                        infoContract.methods.setKeyword(this.domainName.trim().toLowerCase(), item.key.trim().toLowerCase(), item.value.trim()).send(option, (err, msg) => {
                            if (!err) {
                                this.loading = true;
                                this.next(msg, "setKeyword");
                            }
                        });
                    } catch (error) {
                        // User denied account access...
                        console.log(error);
                    }
                } else if (window.web3) {
                    window.web3 = new Web3(web3.currentProvider);
                }
                // Non-dapp browsers...
                else {
                    console.log('Non-Ethereum browser detected. You should consider trying MetaMask!');
                }
            },

            async removeKeyword(item, option) {
                if (window.ethereum) {
                    window.web3 = new Web3(ethereum);
                    try {
                        await ethereum.enable();
                        var infoContract = new web3.eth.Contract(window.elaAbi, window.contractAddres);
                        infoContract.methods.removeKeyword(this.domainName, item.key).send(option, (err, msg) => {
                            if (!err) {
                                this.loading = true;
                                this.next(msg, "removeKeyword");
                            }
                        });
                    } catch (error) {
                        // User denied account access...
                        console.log(error);
                    }
                } else if (window.web3) {
                    window.web3 = new Web3(web3.currentProvider);
                }
                // Non-dapp browsers...
                else {
                    console.log('Non-Ethereum browser detected. You should consider trying MetaMask!');
                }
            },
            init() {
                this.keyValueArr = [];
                let url = window.API_URL+"/nameInfo/get?name=" + this.domainName;
                this.getAjax(url).then((result) => {
                    if (result["code"] === 200) {
                        let domainInfo = result["data"];
                        this.defaultKeys["did"] = domainInfo["did"];
                        this.defaultKeys["publickey"] = domainInfo["publickey"];
                        this.defaultKeys["btc.address"] = domainInfo["btc.address"];
                        this.defaultKeys["ela.address"] = domainInfo["ela.address"];
                        this.defaultKeys["eth.address"] = domainInfo["eth.address"];

                        try {
                            if (domainInfo["publickey"] && domainInfo["publickey"] != "") {
                                this.checkedKeys["publickey"] = true;
                                if (getDid(domainInfo["publickey"]).toLowerCase() == domainInfo["did"].toLowerCase())
                                    this.checkedKeys["did"] = true;

                                if (getAddress(domainInfo["publickey"]).toLowerCase() == domainInfo["ela.address"].toLowerCase())
                                    this.checkedKeys["ela.address"] = true;
                            }
                        }
                        catch (err) {
                            console.log(err);
                        }



                        for (let key in domainInfo) {
                            if (key != "did" && key != "publickey" && key != "btc.address" && key != "eth.address" && key != "ela.address" && key != "name") {
                                this.keyValueArr.push({
                                    "key": key,
                                    "value": domainInfo[key]
                                });

                                try {
                                    if (key == "messenger") {
                                        if (verify(this.domainName.toLowerCase()+".elastos.namemessenger"+this.selectAddress.toLowerCase(), domainInfo["messenger"], domainInfo["publickey"])) {
                                            this.checkedKeys["messenger"] = true;
                                        }
                                    }
                                    else if (key == "messagewall") {
                                        if (verify(this.domainName.toLowerCase()+".elastos.namemessagewall"+this.selectAddress.toLowerCase(), domainInfo["messagewall"], domainInfo["publickey"])) {
                                            this.checkedKeys["messagewall"] = true;
                                        }
                                    }
                                }
                                catch (err) {
                                    console.log(err);
                                }
                            }
                        }
                    }
                }).catch((err) => {

                });
            }
        },
        created() {
            this.domainName = this.GetQueryString("name") || "";
            let data = this.GetQueryString("Data") || "";
            if (data === "") {
                this.init();
            }

            if (data != "") {
                let dataStr = decodeURIComponent(data);
                let dataObj = JSON.parse(dataStr);
                this.defaultKeys.did = dataObj["DID"];
                this.defaultKeys["ela.address"] = dataObj["ELAAddress"];
                this.defaultKeys["btc.address"] = dataObj["BTCAddress"];
                this.defaultKeys["eth.address"] = dataObj["ETHAddress"];
                this.defaultKeys.publickey = dataObj["PublicKey"];

                if (dataObj["publickey"] && dataObj["publickey"] != "") {
                    this.checkedKeys["publickey"] = true;

                    if (getDid(dataObj["publickey"]).toLowerCase() == dataObj["did"].toLowerCase())
                        this.checkedKeys["did"] = true;

                    if (getAddress(dataObj["publickey"]).toLowerCase() == dataObj["ela.address"].toLowerCase())
                        this.checkedKeys["ela.address"] = true;
                }
            }
            window.initWallet().then((address) => {
                this.selectAddress = address;
            }).catch((err) => {

            });
        }
    });
</script>

</html>